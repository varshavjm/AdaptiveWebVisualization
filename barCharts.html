<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
      <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript">
$(document).ready(function() {
      var data;
      var options;
      var chart; 
      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawVisualization);


       function getData(fileName){


        var dataResult;
        $.ajax({                                                                        
          url: fileName,                                                      
          async: false,                                                               
          type: 'GET',                                                                
          dataType: 'json',
           // added data type                                        
          success: function(res) {                                  
            dataResult = res;                                                       
          }                                                                           
        });  
        return dataResult
      }

      function drawVisualization() {
        data=getData("http://127.0.0.1:8000/AllActions.txt");
        var all_items = ['Search', 'Favorite','Upvote','Downvote','Comment','Post'];
        //For filter use delete

        var all_itemsSize=0;
        for(var item in all_items)
          all_itemsSize++;

        result=[];
        result.push(["username"].concat(all_items));                                                                                               
        for(userid in data) {                                                                                                                      
          let user = data[userid];                                                                                                               
          let new_user_data = [user["userName"]]                                                                                                 
          for (index in all_items) {                                                                                                             
              let item = all_items[index];                                                                                                       
              if (item in user.actions) {                                                                                                        
                  new_user_data.push(+user.actions[item])                                                                                        
              }else{                                                                                                                             
                  new_user_data.push(0)                                                                                                          
              }                                                                                                                                  
          }                                                                                                                                      
        result.push(new_user_data);                                                                                                            
    }                                                                      

        
    data = google.visualization.arrayToDataTable(result);

    options = {
      title : 'Actions of different Users',
      vAxis: {title: 'Units'},
      hAxis: {title: 'Users'},
      seriesType: 'bars',
    };
      var view = new google.visualization.DataView(data);
      view.setColumns([0,1,2,3,4,5,6]);

    chart = new google.visualization.ComboChart(document.getElementById('chart_div'));
    google.visualization.events.addListener(chart, 'select', function () {
        highlightBar(chart, options, view);
    });

    chart.draw(view, options);
  }


  function highlightBar(chart, options, view) {
    var selection = chart.getSelection();
    console.log(selection);
    if (selection.length) {
        var row = selection[0].row;
        var column = selection[0].column;
        console.log(row);
        console.log(column);
        view.hideColumns([view.getTableColumnIndex(column)]);
        console.log("Removed column "+ column);
         chart.draw(view, options);
    }
}


    // Will accure at document load
  $("#ResetColumn").on("click",function(){
     var view = new google.visualization.DataView(data);
      view.setColumns([0,1,2,3,4,5,6]);
      chart = new google.visualization.ComboChart(document.getElementById('chart_div'));
      google.visualization.events.addListener(chart, 'select', function () {
        highlightBar(chart, options, view);
    });
       chart.draw(view, options);
  });
});


    </script>
  </head>
  <body>
    <div id="chart_div" style="width: 900px; height: 500px;"></div>
    <button id="ResetColumn"> Reset Filters on Columns</button>
    <button id="ResetRows"> Reset Filters on Rows</button>
  </body>
</html>
